local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Create ScreenGui
local screenGui = Instance.new("ScreenGui", playerGui)
screenGui.Name = "MemoryGameGui"

-- Colors and their corresponding button colors
local colors = {
    {Name = "Red", Color = Color3.fromRGB(255, 0, 0)},
    {Name = "Green", Color = Color3.fromRGB(0, 255, 0)},
    {Name = "Blue", Color = Color3.fromRGB(0, 0, 255)},
    {Name = "Yellow", Color = Color3.fromRGB(255, 255, 0)}
}

-- Create main frame
local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Size = UDim2.new(0, 400, 0, 300)
mainFrame.Position = UDim2.new(0.5, -200, 0.5, -150)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BorderSizePixel = 0
mainFrame.Visible = true

-- Title label
local titleLabel = Instance.new("TextLabel", mainFrame)
titleLabel.Size = UDim2.new(1, 0, 0, 50)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "Memory Game"
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.TextSize = 36
titleLabel.TextColor3 = Color3.new(1, 1, 1)

-- Info label
local infoLabel = Instance.new("TextLabel", mainFrame)
infoLabel.Size = UDim2.new(1, 0, 0, 30)
infoLabel.Position = UDim2.new(0, 0, 0, 50)
infoLabel.BackgroundTransparency = 1
infoLabel.Text = "Press 'Mini Game One' to start"
infoLabel.Font = Enum.Font.SourceSans
infoLabel.TextSize = 20
infoLabel.TextColor3 = Color3.new(1, 1, 1)

-- Mini Game One button
local startButton = Instance.new("TextButton", mainFrame)
startButton.Size = UDim2.new(0, 150, 0, 40)
startButton.Position = UDim2.new(0.5, -75, 0, 90)
startButton.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
startButton.Text = "Mini Game One"
startButton.Font = Enum.Font.SourceSansBold
startButton.TextSize = 24
startButton.TextColor3 = Color3.new(1, 1, 1)
startButton.AutoButtonColor = true

-- Buttons container
local buttonsFrame = Instance.new("Frame", mainFrame)
buttonsFrame.Size = UDim2.new(1, -40, 0, 150)
buttonsFrame.Position = UDim2.new(0, 20, 0, 140)
buttonsFrame.BackgroundTransparency = 1

-- Create color buttons
local buttonSize = UDim2.new(0, 80, 0, 80)
local buttonSpacing = 20
local colorButtons = {}

for i, colorInfo in ipairs(colors) do
    local btn = Instance.new("TextButton", buttonsFrame)
    btn.Size = buttonSize
    btn.Position = UDim2.new(0, (i-1)*(buttonSize.X.Offset + buttonSpacing), 0, 0)
    btn.BackgroundColor3 = colorInfo.Color
    btn.Text = ""
    btn.AutoButtonColor = false
    btn.Name = colorInfo.Name .. "Button"
    colorButtons[colorInfo.Name] = btn
end

-- Game variables
local sequence = {}
local playerSequence = {}
local level = 0
local maxLevel = 5
local inputEnabled = false

-- Tween info for flash animation
local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out, 0, false, 0)

local function flashButton(button)
    local originalColor = button.BackgroundColor3
    local flashColor = Color3.new(1, 1, 1)
    local tweenUp = TweenService:Create(button, tweenInfo, {BackgroundColor3 = flashColor})
    local tweenDown = TweenService:Create(button, tweenInfo, {BackgroundColor3 = originalColor})
    tweenUp:Play()
    tweenUp.Completed:Wait()
    tweenDown:Play()
    tweenDown.Completed:Wait()
end

local function playSequence()
    inputEnabled = false
    for _, colorName in ipairs(sequence) do
        local btn = colorButtons[colorName]
        flashButton(btn)
        wait(0.3)
    end
    inputEnabled = true
    playerSequence = {}
    infoLabel.Text = "Your turn: Repeat the sequence"
end

local function addColorToSequence()
    local randomColor = colors[math.random(1, #colors)].Name
    table.insert(sequence, randomColor)
end

local function resetGame()
    sequence = {}
    playerSequence = {}
    level = 0
    inputEnabled = false
    infoLabel.Text = "Press 'Mini Game One' to start"
    startButton.Visible = true
end

local function endGame(success)
    inputEnabled = false
    if success then
        infoLabel.Text = "Congratulations! You completed all levels!"
    else
        infoLabel.Text = "Game Over! You made a mistake."
    end
    startButton.Text = "Play Again"
    startButton.Visible = true
end

local function onButtonClicked(colorName)
    if not inputEnabled then return end
    table.insert(playerSequence, colorName)
    flashButton(colorButtons[colorName])
    local currentIndex = #playerSequence
    if playerSequence[currentIndex] ~= sequence[currentIndex] then
        endGame(false)
        return
    end
    if currentIndex == #sequence then
        if level == maxLevel then
            endGame(true)
        else
            wait(0.5)
            level = level + 1
            infoLabel.Text = "Level " .. level
            addColorToSequence()
            wait(0.5)
            playSequence()
        end
    end
end

-- Connect color buttons
for colorName, btn in pairs(colorButtons) do
    btn.MouseButton1Click:Connect(function()
        onButtonClicked(colorName)
    end)
end

-- Start button clicked
startButton.MouseButton1Click:Connect(function()
    startButton.Visible = false
    level = 1
    sequence = {}
    playerSequence = {}
    infoLabel.Text = "Level 1"
    addColorToSequence()
    wait(0.5)
    playSequence()
end)

resetGame()
